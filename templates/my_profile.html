{% extends 'base.html' %}
{% block title %} My Page {% endblock %}
{% block content %}
<a href="/"> Homepage </a><br>

<!-- <button id="get-mail"> See Messages </button>
<div id="mailbox"></div>

<div id="mail"> -->
<h1> Mailbox </h1>
{% for sender in message_dict %}
<form action="/delete_convo" method="POST">
<input type="hidden" name="user_id" value="{{ sender }}">
<input type="submit" value="Delete Thread with {{ sender }}">
</form>
<div id="convo"></div>
<span id="{{ sender }}" class="senders" data-last="{{ message_dict[sender][-1][0]}}" data-sender="{{ sender }}">
	{{ sender }}:<br>
	{% for message in message_dict[sender] %}
	{{ message[1] }}<br>
	{% endfor %}
</span>
<form action="/add_message" method="POST">
<textarea maxlength="500" name="message">
</textarea><br>
<input type="hidden" name="user_id" value="{{ sender }}">
<input type="submit" value="Send {{ sender }} a Message">
</form>
{% endfor %}<br><br>

</div>

	{% if user.looking_for_apt %}
	<form action="/deactivate_user" method="POST">
		<input type="hidden" name="user_id" value="{{ user.user_id }}">
		<input type="submit" value="Not Currently Looking for Apt"><br><br>
	</form>
	{% endif %}

	{% if not user.looking_for_apt %}
	<form action="/reactivate_user" method="POST">
		<input type="hidden" name="user_id" value="{{ user.user_id }}">
		<input type="submit" value="Looking once more!"><br><br>
	</form>
	{% endif %}

	Only you can see this: 
	<div id="photo" class="big_photo"> <img src="{{ user.photo }}"> </div>
	<div id="user_name"> USER_NAME: {{ user.user_id }} </div>
	<div id="email"> EMAIL: {{ user.email }} </div>
	<div id="bio"> BIO: {{ user.bio }} </div>
	<div id="state"> STATE: {{ user.state }} </div>
	<div id="looking"> LOOKING FOR APT?: {{ user.looking_for_apt }} </div>
	Answers: <br>
	{% for answer in user.answers %}
	{{  answer.question.question }}: {{ answer.answer }}<br>
	{% endfor %}<br>
	<div id="my-favorites">
	Favorites: <br> 
	{% for listing in user.favorites %}
			<a href="/listings/{{ listing.listing_id }}">
					<img src="{{ listing.main_photo }}">
			</a>
	{% endfor %}
	</div>

<div id="my-listings">
Listings: <br> 
	{% for listing in user.listings %}
			<a href="/listings/{{ listing.listing_id }}">
					<img src="{{ listing.main_photo }}">
			</a>
	{% endfor %}

	{% for property in properties %}
			<a href="/listings/{{ property.listing_id }}">
					<img src="{{ property.main_photo }}">
			</a>
	{% endfor %}

</div>

{% if session.get("current_user") == user.user_id %} 
	<a href="/add_listing"> Add A Listing </a>
{% endif %}
	
<script src="../static/js/mailbox.js"></script>
{% endblock %}
