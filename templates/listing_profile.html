{% extends 'base.html' %}
{% block title %}{{ listing.listing_id }}{% endblock %}
{% block content %}

<a href="/"> Homepage </a><br>
{% if "current_user" in session %}
	<a href="/users/{{ session["current_user"] }}"> View Your Profile </a><br>
{% endif %}<br>

{% if session.get("current_user") and not lister and not am_primary %}
<div id="favorite_or_not">
	{% if not favorite %}
		<button id="favorite" data-listing-id="{{ listing.listing_id }}"> &#9825; Favorite This Listing &#9825;  </button>
	{% endif %}
	{% if favorite %}
		<button id="unfavorite" data-listing-id="{{ listing.listing_id }}"> Unfavorite This Listing </button>
	{% endif %}
</div>
	<div id="chat_form"> 
		<form action="/add_message" method="POST">
			<textarea maxlength="500" name="message">
			</textarea><br>
			<input type="hidden" name="user_id" value="{{ listing.primary_lister }}">
			<input type="submit" value="Send Primary Lister a Message">
		</form>
	</div>

{% if friends %}
	You have friends here!<br><br>
	{% for friend in friends %}
	<div class="friends_in_house">
		{{ friend.user_id }}<br>
		<a href="/users/{{ friend.user_id }}">
				<img src="{{ friend.photo }}" class="small_photo"><br>
		</a><br>
	</div>
	{% endfor %}
{% endif %}

{% if mutuals and not friends %}
	There are people here who are friends of: <br><br>
	{% for mutual in mutuals %}
	<div class="friends_in_house">
		{{ mutual.user_id }}<br>
		<a href="/users/{{ mutual.user_id }}">
				<img src="{{ mutual.photo }}" class="tiny_photo"><br>
		</a><br>
	</div>
	{% endfor %}
{% endif %}


{% endif %}


{% if am_primary %}
	Change primary lister to: 
	<form action="/change_primary" method="POST">
		<select name="new_primary" required>
		{% for user in listing.users %}
  			<option value="{{ user.user_id }}">{{ user.user_id }}</option>
		{% endfor %}
		</select><br>
		<input type="hidden" name="listing_id" value="{{ listing.listing_id }}">
		<input type="submit" value="Change Primary Lister"><br><br>
	</form><br>
{% endif %}

{% if lister %}
	<form action="/remove_self_as_roommate" method="POST">
		<input type="hidden" name="listing_id" value="{{ listing.listing_id }}">
		<input type="submit" value="Remove Yourself As A Roommate"><br><br>
	</form>

	Add A Roommate to This Listing: <br> 
	<form action="/add_roommate" method="POST">
		User Name: <br>
		<select name="roomie" required>
		{% for user in users %}
			{% if user not in listing.users %}
  				<option value="{{ user.user_id }}">{{ user.user_id }}</option>
			{% endif %}
		{% endfor %}
		<input type="hidden" name="listing_id" value="{{ listing.listing_id }}">
		<input type="submit" value="Add Roommate">
		</select>
	</form>

	Remove a Roommate from This Listing: <br> 
	<form action="/remove_roommate" method="POST">
		User Name: <br>
		<select name="roomie" required>
		{% for user in listing.users %}
  			<option value="{{ user.user_id }}">{{ user.user_id }}</option>
		{% endfor %}
		<input type="hidden" name="listing_id" value="{{ listing.listing_id }}">
		<input type="submit" value="Remove Roommate">
		</select>
	</form>
{% endif %}
<br><br>

<h1>{{ listing. address }}</h1>
<div id="map" data-address="{{ listing.address }}"></div><br>
<div class="listing_photos">
	<img src="{{ listing.main_photo }}" class="big_photo"><br>
</div>

{% for photo in listing.photos %}
	<div class="listing_photos">
		<img src="{{ photo.photo }}" class="big_photo"><br>
	</div>
{% endfor %}<br>
<div class="listing_description"><br>
	Neighborhood: {{ listing.neighborhood }}<br>
	Monthly Price: {{ listing.price }}<br>
	<div id="show_avail_dates">
	{% if listing.active %}
	Avail as Of: {{ avail_date }}
	{% else %}
	Listing not Currently Available
	{% endif %}
	</div>
	{% if am_primary %}
		<div id="listed_or_not" data-listing-id="{{ listing.listing_id }}">
		</div>
	{% endif %}
	Length of Rental: {{ listing.length_of_rental }} Months<br>
	{{ listing.description }}<br>
	Bedrooms: {{ listing.bedrooms }}<br>
	Bathrooms: {{ listing.bathrooms }}<br>
	Laundry: {{ listing.laundry }}<br>
	Pets: {{ listing.pets }} <br><br>
</div><br>

{% if primary_lister %}
	Primary Lister <br> (not living on premises):<br>
		<div class="roommates">
			<a href="/users/{{ primary_lister.id }}" class="user" data-user-id="{{ primary_lister.id }}"><br>
						<img src="{{ primary_lister.photo }}" class="small_photo"><br>
						{{ primary_lister.id }}
			</a>
		</div><br><br>
{% endif %}
Roommates: 
	{% for user in listing.users %}<br>
		<div class="roommates">
			<a href="/users/{{ user.user_id }}" class="user" data-user-id="{{ user.user_id }}"><br>
					<img src="{{ user.photo }}" class="small_photo"><br>
					{{ user.user_id }}
					{% if user.user_id == listing.primary_lister %}
					<br>(Primary Lister)
					{% endif %}
			</a>
		</div>
	{% endfor %}
<script src="/static/js/scripts.js"></script>
<script src="/static/js/maps.js"> </script>
<script src="/static/js/listing_profile.js"> </script>
{% endblock %}



